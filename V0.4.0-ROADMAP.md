# Spellcraft v0.4.0 Roadmap

**Created:** 2025-11-10
**Status:** In Progress
**Target Release:** v0.4.0

---

## üéØ Release Goals

### **Goal 1: Complete LZX Parsing**
- **Current:** 7/23 files parsing (30%)
- **Target:** 20+/23 files parsing (90%+)
- **Gap:** Need to parse 13 more files

### **Goal 2: Kaos Brownie Violation Detection**
- **Current:** Needs verification (0/3 expected)
- **Target:** 2-3/3 violations detected (67-100%)
- **Priority Violations:**
  1. ‚úÖ Level 1 (Obvious): Undriven signals - **Already implemented** via ADC-012
  2. ‚è≥ Level 2 (Moderate): Latch inference - **Requires control flow analysis**
  3. ‚è≥ Level 3 (Subtle): Silent overflow - **Requires arithmetic analysis**

---

## üìä Current State Assessment

### Implemented Features ‚úÖ
- [x] Work library support (library/use clauses)
- [x] Process body parsing with control flow
- [x] Expression parsing with operator precedence
- [x] Signal usage tracking (declarations, assignments, reads)
- [x] Undriven/unused signal detection
- [x] Test suite: 36/36 passing

### Missing for LZX Parsing
- [ ] Identify specific parse failure patterns in remaining 16 files
- [ ] Implement missing VHDL constructs
- [ ] Test incrementally

### Missing for Violation Detection
- [ ] Level 1: Verify undriven signal detection works on chaos examples
- [ ] Level 2: Control flow completeness checking (ADC-012 Priority 2)
- [ ] Level 3: Arithmetic bounds checking (ADC-012 Priority 3)

---

## üîß Implementation Tasks

### Phase 1: Verify Signal Usage Detection (Week 1)

**Task 1.1:** Create test cases for undriven signals
```bash
# Test if Level 1 violation detection works
echo "Testing signal usage on kaos examples..."
spellcraft contrib/lzx-kaos-levels/enhance-level1-undriven.vhd
# Expected: Should report undriven signal violation
```

**Success Criteria:**
- ‚úÖ Undriven signals detected and reported
- ‚úÖ Test passes with clear violation message
- ‚úÖ False positive rate < 10%

---

### Phase 2: LZX Parse Rate Improvement (Week 1-2)

**Task 2.1:** Analyze Parse Failures
```bash
# Create analysis script to categorize failures
for file in contrib/lzx/**/*.vhd; do
  spellcraft "$file" 2>&1 | grep "error:" >> parse_failures.txt
done
# Analyze patterns in parse_failures.txt
```

**Task 2.2:** Fix Top Parse Failure Patterns
- Identify top 3 most common parse error patterns
- Implement parser fixes for each pattern
- Test after each fix to verify progress

**Success Criteria:**
- ‚úÖ LZX parse rate reaches 90%+ (20+/23 files)
- ‚úÖ No regressions in existing tests
- ‚úÖ Parse errors have clear, actionable messages

---

### Phase 3: Control Flow Analysis (Week 2-3)

**Task 3.1:** Implement Latch Inference Detection
```haskell
-- ADC-IMPLEMENTS: spellcraft-adc-012-priority2
-- Detect incomplete signal assignments in conditional statements

detectLatchInference :: [Statement] -> [ControlFlowViolation]
detectLatchInference stmts =
  -- Analyze if statements for incomplete assignments
  -- Check if all code paths assign to the same signals
```

**Task 3.2:** Test on Kaos Level 2
```bash
spellcraft contrib/lzx-kaos-levels/enhance-level2-partial.vhd
# Expected: Should report latch inference violation
```

**Success Criteria:**
- ‚úÖ Latch inference detected in chaos Level 2 example
- ‚úÖ False positive rate < 20%
- ‚úÖ Clear violation messages with code location

---

### Phase 4: Arithmetic Bounds Checking (Week 3-4) [STRETCH]

**Task 4.1:** Implement Overflow Detection
```haskell
-- ADC-IMPLEMENTS: spellcraft-adc-012-priority3
-- Detect potential arithmetic overflows

detectArithmeticOverflow :: Expression -> TypeInfo -> [ArithmeticViolation]
detectArithmeticOverflow expr typeInfo =
  -- Check if expression result can exceed type bounds
  -- Detect unbounded accumulators/counters
```

**Task 4.2:** Test on Kaos Level 3
```bash
spellcraft contrib/lzx-kaos-levels/enhance-level3-bitgrowth.vhd
# Expected: Should report potential overflow violation
```

**Success Criteria:**
- ‚úÖ Overflow detected in chaos Level 3 example
- ‚úÖ False positive rate < 30% (acceptable for this subtlety level)
- ‚úÖ Helpful warning messages

---

## üìã Definition of Done

### v0.4.0 Release Criteria

**Must Have:**
1. ‚úÖ LZX parse rate ‚â• 90% (20+/23 files)
2. ‚úÖ Level 1 violations detected (undriven signals)
3. ‚úÖ All tests passing (36+/36+)
4. ‚úÖ No regressions from v0.3.0
5. ‚úÖ Documentation updated

**Should Have:**
6. ‚úÖ Level 2 violations detected (latch inference)
7. ‚úÖ Control flow analysis implemented
8. ‚úÖ 40+ tests passing

**Could Have:**
9. ‚è≥ Level 3 violations detected (arithmetic overflow)
10. ‚è≥ Arithmetic bounds checking implemented
11. ‚è≥ 45+ tests passing

---

## üß™ Testing Strategy

### Test Pyramid

**Unit Tests (40+ target):**
- Work library parsing (3)
- Process parsing (8)
- Type-level Clash (25)
- Signal usage detection (4+) - **NEW**
- Control flow analysis (5+) - **NEW**
- Arithmetic checking (3+) - **NEW** [STRETCH]

**Integration Tests:**
- LZX corpus (23 files, target 20+ passing)
- Kaos brownie (4 files, target 2-3 violations detected)

**Regression Tests:**
- All existing examples continue working
- No false positives on valid designs

---

## üìä Success Metrics

### Primary Metrics
- **LZX Parse Rate:** 30% ‚Üí 90%+ ‚úÖ
- **Violation Detection:** 0% ‚Üí 67-100% ‚úÖ
- **Test Coverage:** 36 ‚Üí 40+ tests ‚úÖ

### Secondary Metrics
- **False Positive Rate:** < 20% for Level 1-2
- **Build Time:** < 20s clean build
- **Test Execution:** < 2s total

---

## üöÄ Release Timeline

**Week 1:**
- Day 1-2: Verify signal usage detection, analyze LZX failures
- Day 3-5: Fix top 3 parse failure patterns
- Day 6-7: Test LZX parse rate, iterate if needed

**Week 2:**
- Day 1-3: Implement control flow analysis
- Day 4-5: Test latch inference detection
- Day 6-7: Polish and documentation

**Week 3:** [STRETCH]
- Day 1-5: Arithmetic bounds checking
- Day 6-7: Final testing and release prep

---

## üîó Related Documents

- `CHANGELOG.md` - Version history
- `KAOS_BROWNIE_EVALUATION_REPORT.md` - Violation detection evaluation
- `contracts/adc-012-violation-detection.qmd` - Violation detection contract
- `contracts/adc-009-vhdl-parser-enhancement.qmd` - Parser enhancement contract

---

**Roadmap Status:** üü° In Progress
**Next Milestone:** Phase 1 - Verify Signal Usage Detection
**Blockers:** None currently
